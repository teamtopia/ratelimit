local a=KEYS[1]local b=tonumber(ARGV[1])local c=tonumber(ARGV[b+2])local d=b+c;local e=tonumber(ARGV[d+3])local f=tonumber(ARGV[d+4])local g=tonumber(ARGV[d+5])local h=tonumber(ARGV[d+6])local i=tonumber(ARGV[d+7])local j=tonumber(ARGV[d+8])or 0;local k=false;local l=false;local m=false;local n=0;if c>0 then local o=redis.call("HMGET",a,unpack(ARGV,b+3,d+2))for p,q in ipairs(o)do n=n+(tonumber(q)or 0)end;if n<j then l=true end end;local r=0;local s=redis.call("HMGET",a,unpack(ARGV,2,b+1))for p,q in ipairs(s)do r=r+(tonumber(q)or 0)end;if r<h then m=true end;if m or l then redis.call("HINCRBY",a,e,i)redis.call("HDEL",a,(e+1)%f)redis.call("HDEL",a,(e+2)%f)redis.call("EXPIRE",a,g)k=true end;return k